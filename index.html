<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Supermarket Experiment</title>



<script>
  if ('scrollRestoration' in history) {
    history.scrollRestoration = 'manual';
  }
  window.addEventListener('load', function () {
    window.scrollTo(0, 0);
  });
</script>



<style>
/* -----------------------------------------------------------
   GENERAL
----------------------------------------------------------- */
body {
    margin: 0;
    font-family: 'Inter', Arial, sans-serif;
    background: #f4f4f5;
    padding-top: 80px; /* prima 130px + barra, ora basta 120 */
    display: flex;
    justify-content: center;
	
}


/* HEADER MODERNO -------------------------------------------------- */
#header {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 80px;
    background: linear-gradient(135deg, #0f172a, #1e293b);
    color: #f9fafb;
    box-shadow: 0 4px 18px rgba(15,23,42,0.45);
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 32px;
    z-index: 1000;
}

.header-left {
    display: flex;
    flex-direction: column;
    gap: 4px;
}

#header h2 {
    margin: 0;
    font-size: 22px;
    font-weight: 700;
    letter-spacing: -0.03em;
}

#headerInstruction {
    font-size: 13px;
    color: #e5e7eb;
    opacity: 0.9;
}

/* lato destro: info + pulsante carrello */
.header-right {
    display: flex;
    align-items: center;
    gap: 10px;
	margin-right:5%;
}

#cartInfoMessage {
    font-size: 13px;
    padding: 6px 10px;
    border-radius: 999px;
    background: rgba(15,23,42,0.7);
    border: 1px solid rgba(148,163,184,0.5);
    color: #e5e7eb;
}

/* pulsante carrello stile pill */
.cartButton {
    background: #facc15;
    color: #111827;
    padding: 9px 18px;
    border-radius: 999px;
    font-size: 14px;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 6px;
    cursor: pointer;
    border: none;
    box-shadow: 0 6px 14px rgba(250,204,21,0.55);
    transition: transform 0.15s ease, box-shadow 0.15s ease, background 0.15s ease;
}

.cartButton:hover {
    background: #eab308;
    transform: translateY(-1px);
    box-shadow: 0 10px 18px rgba(250,204,21,0.6);
}



#categoryBar {
    position: fixed;
    top: 80px;
    left: 0;
    width: 100%;
    background: linear-gradient(90deg, #f8fafc 0%, #f1f5f9 50%, #f8fafc 100%);
    border-bottom: 1px solid rgba(148,163,184,0.2);
    padding: 12px 20px;
    z-index: 950;
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    justify-content: center;
    font-size: 14px;
    backdrop-filter: blur(8px);
    box-shadow: 0 2px 8px rgba(0,0,0,0.04);

}



/* -----------------------------------------------------------
   PRODUCT GRID
----------------------------------------------------------- */
#shelf {
    width: 90%;
    max-width: 1300px;
        background: rgba(255, 255, 255, 0.7);
    backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.5);
    padding: 20px;
    border-radius: 18px;
    box-shadow: 0 3px 12px rgba(0,0,0,0.08);
}


/* 5 colonne fisse sempre */
.row {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    gap: 10px;
}



/* -----------------------------------------------------------
   PRODUCT CARDS
----------------------------------------------------------- */
.product {
    background: #ffffff;
    border-radius: 14px;
    padding: 8px;
    height: 210px; /* FIX */
    display: flex;
    flex-direction: column;
    justify-content: flex-start;
    align-items: center;
    text-align: center;
    cursor: pointer;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    transition: transform 0.15s;
}

.product:hover {
    transform: translateY(-3px);
}


.productGrid {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    gap: 18px;
    width: 100%;
}


.product img {
    width: 100%;
    height: 120px;
    object-fit: contain;
    border-radius: 8px;
}



/* titolo prodotto */
.name {
    font-size: 14px;
    margin-top: 6px;
    font-weight: 600;
    color: #222;
}

.price {
    font-size: 14px;
    color: #0a9d2a;
    font-weight: bold;
    margin-top: 3px;
}


/* -----------------------------------------------------------
   CART PAGE
----------------------------------------------------------- */
#cartPage {
    display: none;
    background: #ffffff;
    padding: 35px 40px;
    border-radius: 22px;
    width: 90%; max-width: 900px;
    box-shadow: 0px 5px 18px rgba(0,0,0,0.1);
    animation: fadeIn 0.4s ease-in-out;
	margin-top: 100px; 
	margin-bottom: 100px; 
}

#cartPage h2 {
    font-size: 26px;
    font-weight: 600;
    margin-bottom: 15px;
    border-bottom: 1px solid #ddd;
    padding-bottom: 8px;
}

#cartList li {
    padding: 8px 0;
    font-size: 16px;
    border-bottom: 1px solid #eee;
}

/* -----------------------------------------------------------
   BUTTONS
----------------------------------------------------------- */
button {
    padding: 14px 24px;
    border-radius: 14px;
    font-size: 17px;
    font-weight: 600;
    cursor: pointer;
    border: none;
}

#finishBtn {
    background: #ffd700;  /* Gold Yellow */
    color: #111;
}
#finishBtn:hover {
    background: #e6c200;
}

#backBtn {
    background: #111;
    color: white;
}
#backBtn:hover {
    background: #333;
}



/* -----------------------------------------------------------
   ANIMATION
----------------------------------------------------------- */
@keyframes fadeIn {
    from {opacity: 0; transform: translateY(10px);}
    to   {opacity: 1; transform: translateY(0);}
}


#instructionBar {
    position: fixed;
    top: 70px;                   /* subito sotto l‚Äôheader */
    left: 0;
    width: 100%;
    height: 50px;               /* altezza fissa */
    background:#fff8c4;
    border-bottom:1px solid #f0d97b;
    font-size:16px;
    display:flex;
    justify-content:center;
    align-items:center;
    z-index: 999;               /* sotto l‚Äôheader, sopra i prodotti */
    font-weight: 500;
}


#cartInfoMessage {

    font-size: 14px;
    background: #fff8c4;
    border: 1px solid #f0d97b;
    border-radius: 8px;

    text-align: center;
    color: #444;
}


/* üìå RESPONSIVE LAYOUT */

/* üîµ Tablet (max-width: 1024px) */
@media (max-width: 1024px) {
    body {
        padding-top: 120px;
        zoom: 0.95;
    }

    #shelf {
        width: 95%;
        padding: 15px;
    }

    .productGrid {
        grid-template-columns: repeat(4, 1fr); /* 4 prodotti per riga */
        gap: 14px;
    }

    .product {
        height: 200px;
        padding: 8px;
    }

    .product img {
        height: 110px;
    }
}

/* üü¢ Smartphone (max-width: 700px) */
@media (max-width: 700px) {
    body {
        padding-top: 120px;
        justify-content: flex-start;
    }

    #header {
        padding: 0 20px;
        height: 65px;
    }

    #header h2 {
        font-size: 18px;
    }

    #instructionBar {
        height: 60px;
        font-size: 13px;
        text-align: center;
        padding: 0 10px;
    }

    #cartButton, #header div {
        padding: 7px 12px;
        border-radius: 14px;
        font-size: 14px;
    }

    .productGrid {
        grid-template-columns: repeat(2, 1fr); /* 2 prodotti per riga */
        gap: 12px;
    }

    .product {
        height: 180px;
        padding: 6px;
    }

    .product img {
        height: 90px;
    }

    .name {
        font-size: 12px;
    }

    .price {
        font-size: 12px;
    }


    #cartPage h2 {
        font-size: 20px;
    }

    button {
        width: 100%;
        margin-top: 10px;
        font-size: 16px;
        padding: 12px 0;
    }

    #toast {
        right: 15px;
        top: 90px;
        font-size: 13px;
        padding: 10px 14px;
    }
}

/* üî¥ Mobile piccolo (max-width: 400px) */
@media (max-width: 400px) {
    .productGrid {
        grid-template-columns: 1fr; /* 1 prodotto per riga */
    }

    #header h2 {
        font-size: 16px;
    }

    #instructionBar {
        font-size: 12px;
    }
}



/* -----------------------------------------------------------
   MODAL SCREENS (INTRO, START, THANK YOU)
----------------------------------------------------------- */


/* INTRO SCREEN - MODERNA */
#introScreen {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: linear-gradient(135deg, #f0f4f8 0%, #e9ecf1 100%);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 2000;
    font-family: 'Inter', Arial, sans-serif;
}

.intro-modal {
    background: white;
    width: 480px;
    padding: 50px 45px;
    border-radius: 24px;
    box-shadow: 0 8px 32px rgba(15,23,42,0.12);
    border: 1px solid rgba(255,255,255,0.8);
    text-align: center;
    animation: fadeIn 0.5s ease-in-out;
}

.intro-logo-section {
    margin-bottom: 20px;
}

.intro-logo {
    height: 180px;
    object-fit: contain;
    margin-bottom: 8px;
}

.intro-subtitle {
    margin: 0;
    font-size: 12px;
    color: #64748b;
    letter-spacing: 1px;
    text-transform: uppercase;
    font-weight: 600;
}

.intro-modal h2 {
    margin: 0 0 16px 0;
    color: #0f172a;
    font-size: 32px;
    font-weight: 700;
    letter-spacing: -0.5px;
}

.intro-modal p {
    color: #475569;
    font-size: 15px;
    line-height: 1.8;
    margin-bottom: 32px;
}

.intro-btn {
    width: 100%;
    padding: 16px 0;
    font-size: 16px;
    font-weight: 600;
    background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
    color: white;
    border: none;
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 4px 12px rgba(15,23,42,0.25);
}

.intro-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(15,23,42,0.35);
}







/* START SCREEN - PARTICIPANT INFO */
#startScreen {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: linear-gradient(135deg, #f0f4f8 0%, #e9ecf1 100%);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 2000;
    font-family: 'Inter', Arial, sans-serif;
}

.start-modal {
    background: white;
    width: 480px;
    padding: 50px 45px;
    border-radius: 24px;
    box-shadow: 0 8px 32px rgba(15,23,42,0.12);
    border: 1px solid rgba(255,255,255,0.8);
    text-align: center;
    animation: fadeIn 0.5s ease-in-out;
}

.start-modal h2 {
    margin: 0 0 12px 0;
    color: #0f172a;
    font-size: 28px;
    font-weight: 700;
    letter-spacing: -0.5px;
}

.start-modal p {
    color: #64748b;
    font-size: 14px;
    margin-bottom: 24px;
}

.form-group {
    margin-bottom: 20px;
    text-align: left;
}

.form-label {
    display: block;
    margin-bottom: 8px;
    font-size: 13px;
    font-weight: 600;
    color: #0f172a;
}

.form-input,
.form-select {
    width: 100%;
    padding: 11px 13px;
    border: 1.5px solid #cbd5e1;
    border-radius: 10px;
    font-size: 14px;
    font-family: 'Inter', Arial, sans-serif;
    background: #f8fafc;
    color: #0f172a;
    transition: all 0.2s ease;
    box-sizing: border-box;
}

.form-input:focus,
.form-select:focus {
    outline: none;
    border-color: #0f172a;
    background: white;
    box-shadow: 0 0 0 3px rgba(15,23,42,0.1);
}

.start-btn {
    width: 100%;
    padding: 16px 0;
    margin-top: 24px;
    font-size: 16px;
    font-weight: 600;
    background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    color: white;
    border: none;
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 4px 12px rgba(16,185,129,0.25);
}

.start-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(16,185,129,0.35);
}









#thankYouScreen {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: linear-gradient(to bottom, #f0f4f8, #e9ecf1);
    z-index: 2000;
    display: none;
    justify-content: center;
    align-items: center;
}


#thankYouScreen {
    background: linear-gradient(to bottom, #f0f4f8, #e9ecf1);

}

.thank-you-modal {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(20px);
    border-radius: 28px;
    width: 480px;
    padding: 50px 45px;
    text-align: center;
    box-shadow: 0 20px 60px rgba(15,23,42,0.3);
    border: 1px solid rgba(255, 255, 255, 0.8);
    animation: slideUp 0.6s cubic-bezier(0.16, 1, 0.3, 1);
}

@keyframes slideUp {
    from {
        opacity: 0;
        transform: translateY(30px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.thank-you-icon {
    font-size: 64px;
    margin-bottom: 16px;
    animation: bounce 0.6s ease-in-out 0.3s both;
}

@keyframes bounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-15px); }
}

.thank-you-modal h2 {
    margin: 0 0 8px 0;
    font-size: 32px;
    font-weight: 700;
    background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    letter-spacing: -0.5px;
}

.thank-you-modal p {
    color: #475569;
    font-size: 15px;
    line-height: 1.8;
    margin: 20px 0;
}

.thank-you-btn {
    margin-top: 32px;
    padding: 14px 28px;
    font-size: 16px;
    font-weight: 600;
    border: none;
    border-radius: 12px;
    cursor: pointer;
    background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
    color: white;
    box-shadow: 0 8px 20px rgba(15,23,42,0.3);
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    gap: 8px;
}

.thank-you-btn:hover {
    transform: translateY(-3px);
    box-shadow: 0 12px 28px rgba(15,23,42,0.4);
}



/* üü¢ Smartphone (max-width: 700px) */
@media (max-width: 700px) {
    body {
        padding-top: 120px;
        justify-content: flex-start;
    }

    #header {
        padding: 0 20px;
        height: 65px;
    }

    #header h2 {
        font-size: 18px;
    }

    #instructionBar {
        height: 60px;
        font-size: 13px;
        text-align: center;
        padding: 0 10px;
    }

    #cartButton, #header div {
        padding: 7px 12px;
        border-radius: 14px;
        font-size: 14px;
    }

    .productGrid {
        grid-template-columns: repeat(2, 1fr); /* 2 prodotti per riga */
        gap: 12px;
    }

    .product {
        height: 180px;
        padding: 6px;
    }

    .product img {
        height: 90px;
    }

    .name {
        font-size: 12px;
    }

    .price {
        font-size: 12px;
    <!-- } -->


	#cartPage {
		width: 70%;
		padding: 20px 15px;
		margin-top: 20px;
		margin-left: auto;
		margin-right: auto;
	}

	#cartList li {
		font-size: 14px;
		margin-left: 20px;
		
		
	}
	
    #cartPage h2 {
        font-size: 20px;
    }

    
    #finishBtn,
    #backBtn,
    .intro-btn,
    .start-btn,
    .thank-you-btn {
        width: 100%;
        margin-top: 10px;
        font-size: 16px;
        padding: 12px 0;
    }

    #toast {
        right: 15px;
        top: 90px;
        font-size: 13px;
        padding: 10px 14px;
    }
}


/* üü¢ Smartphone (max-width: 700px) */
@media (max-width: 700px) {
    /* niente layout flex che spinge tutto a destra */
    body {
        display: block;
        padding-top: 20px;
    }

    /* HEADER: non fisso, pi√π compatto */
    #header {
        position: static;
        width: 100%;
        height: auto;
        padding: 12px 16px;
        flex-direction: column;
        align-items: flex-start;
        gap: 6px;
    }

    .header-left {
        gap: 2px;
    }

    #header h2 {
        font-size: 20px;
    }

    #headerInstruction {
        font-size: 12px;
    }

    .header-right {
        align-self: stretch;
        justify-content: flex-end;
        gap: 8px;
    }

    .cartButton {
        padding: 7px 14px;
        font-size: 13px;
    }

    #cartInfoMessage {
        font-size: 12px;
        padding: 5px 8px;
    }

    /* NASCONDI la barra gialla/colonna sinistra */
    #instructionBar {
        display: none;
    }

    /* CATEGORY BAR centrata, pulsanti pi√π stretti */
    #categoryBar {
        position: static;
        width: 100%;
        padding: 12px 10px;
        justify-content: center;
        gap: 8px;
    }

    .catTab {
        width: 80%;
        max-width: 360px;
        text-align: center;
        font-size: 14px;
    }

    /* GRID PRODOTTI */
    #shelf {
        width: 95%;
        padding: 15px;
        margin: 0 auto;
    }

    .productGrid {
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
    }

    .product {
        height: 180px;
        padding: 6px;
    }

    .product img {
        height: 90px;
    }

    .name,
    .price {
        font-size: 12px;
    }


    #cartPage h2 {
        font-size: 20px;
    }

    button {
        width: 100%;
        margin-top: 10px;
        font-size: 16px;
        padding: 12px 0;
    }

    #toast {
        right: 15px;
        top: 80px;
        font-size: 13px;
        padding: 10px 14px;
    }

    /* MODALI all‚Äô80% larghezza */
    .intro-modal,
    .start-modal,
    .thank-you-modal {
        width: 80%;
        max-width: 380px;
        padding: 30px 24px;
    }

    .intro-logo {
        height: 80px;
    }
}




.removeBtn {
    margin-left: 8px;
    padding: 3px 8px;
    font-size: 11px;
    border-radius: 10px;
    background: #e5e7eb;
    color: #111827;
    border: 1px solid #d1d5db;
    cursor: pointer;
    white-space: nowrap; /* non va a capo */
    flex-shrink: 0;
}


.removeBtn:hover {
    background: #d1d5db;
}


#cartList li {
    padding: 8px 0;
    font-size: 16px;
    border-bottom: 1px solid #eee;
}



@media (max-width: 700px) {
    #cartList li {
        font-size: 14px;
    }

    .removeBtn {
        padding: 2px 6px;
        font-size: 10px;
    }
}





@media (max-width: 700px) {
    #cartPage {
        width: 80%;
        padding: 20px 15px;
        margin-top: 20px;
        margin-left: auto;
        margin-right: auto;
    }
}


@media (max-width: 700px) {
    #cartList li {
        margin-left: 10px;  /* o 15px se ti piace di pi√π */
    }
}


</style>








<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">


</head>








<body>








<div id="header">
  <div class="header-left">
    <h2>Supermarket Experiment</h2>
    <div id="headerInstruction">
      üõí When you finish your shopping, click the cart and then <b>Finish Shopping</b>.
    </div>
  </div>

  <div class="header-right">
    <div id="cartInfoMessage">
      Cart: <span id="cartCount">0</span> items
    </div>
    <div class="cartButton" onclick="openCart()">
      üõí Cart
    </div>
  </div>
</div>





<!-- CATEGORY BAR -->
<div id="categoryBar">
    <button class="catTab active" onclick="setCategory('ALL')">All</button>
    <button class="catTab" onclick="setCategory('BREAKFAST')">Breakfast</button>
    <button class="catTab" onclick="setCategory('SNACKS')">Snacks & Sweets</button>
    <button class="catTab" onclick="setCategory('DRINKS')">Drinks</button>
    <button class="catTab" onclick="setCategory('FRESH')">Fresh & Dairy</button>
    <button class="catTab" onclick="setCategory('HEALTHY')">Veg & Healthy</button>
    <button class="catTab" onclick="setCategory('PANTRY')">Pantry</button>
</div>





<div id="introScreen">
    <div class="intro-modal">
        <div class="intro-logo-section">
            <img src="img/Imagen1.png" alt="Politecnico di Milano" class="intro-logo">
            <p class="intro-subtitle">Research Study</p>
        </div>

        <h2>Supermarket Experiment</h2>

        <p>You will simulate a grocery shopping session. Select the products you would normally buy by clicking on them. When finished, open the basket (top right) and click <b>Finish Shopping</b>. Act as naturally as possible, as if you were in a real supermarket.</p>

        <button class="intro-btn" onclick="showParticipantForm()">
            Start Experiment ‚Üí
        </button>
    </div>
</div>





<div id="startScreen">
    <div class="start-modal">
        <h2>Participant Information</h2>
        <p>Please fill in the information below to begin the experiment.</p>

        <div style="text-align: left; margin-bottom: 24px;">
            <div class="form-group">
                <label class="form-label">Age</label>
                <input id="ageInput" type="number" min="10" max="100" class="form-input" placeholder="Enter your age">
            </div>

            <div class="form-group">
                <label class="form-label">Gender</label>
                <select id="genderInput" class="form-select">
                    <option value="">Select...</option>
                    <option value="Male">Male</option>
                    <option value="Female">Female</option>
                    <option value="Other">Other</option>
                </select>
            </div>

            <div class="form-group">
                <label class="form-label">Nationality</label>
                <select id="nationInput" class="form-select">
                    <option value="">Select country...</option>
                    <option value="Italy">Italy</option>
                    <option value="France">France</option>
                    <option value="Spain">Spain</option>
                    <option value="Germany">Germany</option>
                    <option value="Portugal">Portugal</option>
                    <option value="Netherlands">Netherlands</option>
                    <option value="Belgium">Belgium</option>
                    <option value="Sweden">Sweden</option>
                    <option value="Norway">Norway</option>
                    <option value="Denmark">Denmark</option>
                    <option value="Finland">Finland</option>
                    <option value="Austria">Austria</option>
                    <option value="Switzerland">Switzerland</option>
                    <option value="Poland">Poland</option>
                    <option value="Czech Republic">Czech Republic</option>
                    <option value="Slovakia">Slovakia</option>
                    <option value="Greece">Greece</option>
                    <option value="Ireland">Ireland</option>
                    <option value="Romania">Romania</option>
                    <option value="Bulgaria">Bulgaria</option>
                    <option value="Hungary">Hungary</option>
                </select>
            </div>

            <div class="form-group">
                <label class="form-label">Online Shopping Frequency</label>
                <select id="onlineInput" class="form-select">
                    <option value="Never">Never</option>
                    <option value="Rarely">Rarely</option>
                    <option value="Sometimes">Sometimes</option>
                    <option value="Often">Often</option>
                </select>
            </div>

            <div class="form-group">
                <label class="form-label">Weekly Grocery Shopping</label>
                <select id="freqInput" class="form-select">
                    <option value="1-2">1‚Äì2 times</option>
                    <option value="3-4">3‚Äì4 times</option>
                    <option value="5+">5 or more</option>
                </select>
            </div>
        </div>

        <button class="start-btn" onclick="startExperiment()">
            Start the Experiment ‚úì
        </button>
    </div>
</div>







<style>
    .label {
        display:block;
        margin-bottom:6px;
        margin-top:12px;
        font-size:14px;
        font-weight:bold;
        color:#555;
    }
    .input {
        width:100%;
        padding:10px;
        border:1px solid #ccc;
        border-radius:10px;
        font-size:15px;
        outline:none;
        background:#f9f9f9;
        transition:0.2s;
        margin-bottom:5px;
    }
    .input:focus {
        border-color:#888;
        background:white;
        box-shadow:0 0 5px rgba(0,0,0,0.1);
    }
    @keyframes fadeIn {
        from {opacity:0; transform:translateY(10px);}
        to   {opacity:1; transform:translateY(0);}
    }
	
	
	
	
.catTab {
    padding: 6px 14px;
    border-radius: 999px;
    border: 1px solid #e5e7eb;
    background: #ffffff;
    cursor: pointer;
    font-size: 13px;
    color: #4b5563;
    transition: 0.15s ease;
}
.catTab:hover {
    background: #f3f4f6;
}
.catTab.active {
    background: #0f172a;
    color: #f9fafb;
    border-color: #0f172a;
}


</style>

















<div id="shelf" style="margin-top: 110px;">
    <h3>Loading products...</h3>
</div>



<div id="cartPage">
    <h2 style="color:#004aad;">Selected products</h2>
    <div id="cartList"></div>

    <p id="cartTotalDisplay" style="font-weight:bold; margin-top:10px;">
        Totale: ‚Ç¨ 0.00
    </p>

    <button id="finishBtn" onclick="finishShopping()">Finish Shopping</button>
    <button id="backBtn" onclick="closeCart()">Back</button>
</div>




<div id="toast">Added to cart</div>

<style>
#toast {
    position: fixed;
    top: 90px;
    right: 30px;
    background: #111;
    color: white;
    padding: 12px 18px;
    border-radius: 12px;
    font-size: 15px;
    opacity: 0;
    transform: translateY(-10px);
    pointer-events: none;
    transition: all 0.35s ease;
    z-index: 3000;
}
#toast.show {
    opacity: 1;
    transform: translateY(0);
}
</style>



<script>



// Evita doppio-tap zoom
let lastTouchEnd = 0;
document.addEventListener('touchend', function (event) {
    const now = Date.now();
    if (now - lastTouchEnd <= 300) {
        event.preventDefault(); // blocca zoom da doppio tap
    }
    lastTouchEnd = now;
}, { passive: false });

// Evita pinch-zoom (2+ dita)
document.addEventListener('touchstart', function (event) {
    if (event.touches.length > 1) {
        event.preventDefault();
    }
}, { passive: false });

	
// -----------------------------------------------------------------------------
// LOGGING
// -----------------------------------------------------------------------------
let experimentStart = Date.now();
let hoverLog = [];
let indecisionLog = [];
let clickLog = [];
let cart = [];
let cartTotal = 0;


// -----------------------------------------------------------------------------
// 70 PRODUCTS (ALL IMAGES EMPTY, YOU WILL FILL THEM)
// -----------------------------------------------------------------------------
const products = [
    // ---- Products you provided ----
	
	
	
{name:"Nutella 950g", price:4.99, category:"Sweet spreads", img:"img/Nutella_950g_Ferrero.jpg"},
{name:"Krave Cereal", price:3.49, category:"Cereal", img:"img/front_it.22.200 (1).jpg"},
{name:"Kinder Colazione Pi√π", price:2.99, category:"Snacks", img:"img/front_it.24.200.jpg"},
{name:"Yogurt Magro Vipiteno", price:1.20, category:"Dairy", img:"img/front_it.25.200 (1).jpg"},
{name:"Lindt 100% Cacao", price:2.99, category:"Chocolate", img:"img/front_it.28.200.jpg"},
{name:"Mulino Bianco Cioccograno", price:2.50, category:"Biscuits", img:"img/front_it.31.200.jpg"},
{name:"Unconventional Veggie Burger", price:3.90, category:"Vegan", img:"img/front_it.32.200.jpg"},
{name:"Peanut Butter Maribel 100%", price:2.49, category:"Spreads", img:"img/front_it.33.200.jpg"},
{name:"Nutella Plant Based", price:4.99, category:"Sweet spreads", img:"img/front_it.53.200 (2).jpg"},

{name:"Barilla Penne Rigate Integrali", price:1.29, category:"Pasta", img:"img/front_it.54.200 (3).jpg"},
{name:"Gran Cereale Riso & Cornflakes", price:2.49, category:"Biscuits", img:"img/front_it.54.200.jpg"},
{name:"Pan di Stelle Cookies", price:2.99, category:"Biscuits", img:"img/front_it.62.200.jpg"},
{name:"Gocciole Extra Dark", price:2.79, category:"Biscuits", img:"img/front_it.66.200 (2).jpg"},
{name:"Yogurt Intero Vipiteno", price:1.20, category:"Dairy", img:"img/front_it.42.200.jpg"},
{name:"Garden Gourmet Soy Strips", price:3.99, category:"Vegan", img:"img/front_it.43.200 (1).jpg"},
{name:"Mulino Bianco Fette Integrali", price:1.89, category:"Bakery", img:"img/front_it.53.200 (1).jpg"},
{name:"Kioene Spinach Miniburger", price:3.49, category:"Vegan", img:"img/front_it.53.200.jpg"},
{name:"Fiorentini Peanut Butter", price:2.90, category:"Spreads", img:"img/front_it.54.200 (1).jpg"},

{name:"Galbusera Buoni Cos√¨", price:2.49, category:"Biscuits", img:"img/front_it.58.200.jpg"},
{name:"Barilla Pesto alla Genovese", price:3.49, category:"Sauce", img:"img/front_it.86.200.jpg"},
{name:"Milk Kefir Naturale", price:1.99, category:"Dairy", img:"img/front_it.89.200.jpg"},
{name:"My Best Veggie Hummus", price:1.49, category:"Vegan", img:"img/front_it.95.200 (1).jpg"},
{name:"Mulino Bianco Molinetti", price:2.49, category:"Biscuits", img:"img/front_it.100.200.jpg"},
{name:"Mulino Bianco Pan Bauletto", price:1.89, category:"Bread", img:"img/front_it.116.200.jpg"},
{name:"Arborea Semi-skimmed Milk", price:1.29, category:"Dairy", img:"img/front_it.104.200.jpg"},
{name:"Heinz Tomato Ketchup", price:2.49, category:"Sauce", img:"img/front_it.105.200.jpg"},
{name:"Coca Cola Zero Can", price:1.00, category:"Drinks", img:"img/front_it.70.200.jpg"},
{name:"Wasa Crackers Integrale", price:1.89, category:"Dry", img:"img/front_it.72.200.jpg"},

{name:"Nesquik Powder", price:3.99, category:"Sweet", img:"img/front_it.54.200 (2).jpg"},
{name:"Pan Bauletto Grano D‚ÄôOro", price:1.99, category:"Bread", img:"img/front_it.116.200.jpg"},
{name:"Gocciole Chocolate", price:2.69, category:"Biscuits", img:"img/front_it.66.200 (2).jpg"},
{name:"Kellogg All Bran", price:3.29, category:"Cereal", img:"img/front_it.136.200.jpg"},
{name:"Mutti Passata", price:1.49, category:"Sauce", img:"img/front_it.195.200.jpg"},
{name:"Alpro Mango Soy Yogurt", price:2.19, category:"Dairy-free", img:"img/Mango.jpg"},
{name:"Star Mustard", price:1.29, category:"Sauce", img:"img/Mustard.jpg"},
{name:"Barilla Spaghetti N.5", price:1.19, category:"Pasta", img:"img/Pasta.jpg"},
{name:"Rana Ricotta & Spinach Tortellini", price:2.99, category:"Fresh Pasta", img:"img/Ricotta.jpg"},
{name:"Capitan Findus 18 Fish Sticks", price:3.50, category:"Frozen", img:"img/front_it.8.200.jpg"},


{name:"Ritz Crackers Original 200g", price:2.49, category:"Snacks", img:"img/front_fr.17.200.jpg"},
{name:"Rovagnati Snello Ham 120g", price:3.29, category:"Cold cuts", img:"img/front_it.3.200 (2) - Copia.jpg"},
{name:"Cameo Vitalis Muesli No Added Sugar 300g", price:3.49, category:"Cereal", img:"img/front_it.3.200 (3).jpg"},
{name:"Mulino Bianco Abbracci Cookies 350g", price:2.99, category:"Biscuits", img:"img/front_it.3.200 (4).jpg"},
{name:"Conad Verso Natura Organic Granola with Chocolate 400g", price:2.79, category:"Cereal", img:"img/front_it.3.200 (5) - Copia.jpg"},
{name:"Conad Verso Natura Organic Spinach Veggie Burgers", price:3.49, category:"Vegan", img:"img/front_it.3.200 (6) - Copia.jpg"},
{name:"Valfrutta Cannellini Beans Jar", price:1.49, category:"Canned", img:"img/front_it.4.200.jpg"},
{name:"Gran Pavesi Crackers Low Salt", price:2.29, category:"Snacks", img:"img/front_it.9.200.jpg"},
{name:"Kellogg's Coco Pops Barchrette", price:3.99, category:"Cereal", img:"img/front_it.10.200.jpg"},
{name:"Loacker Napolitaner Wafers", price:2.19, category:"Biscuits", img:"img/front_it.44.200.jpg"},

{name:"Sottilette Classic Cheese Slices", price:2.49, category:"Dairy", img:"img/front_it.53.200 (3).jpg"},
{name:"Bauli Pandoro di Verona", price:6.99, category:"Bakery", img:"img/front_it.49.200.jpg"},
{name:"Philadelphia Original XL", price:3.49, category:"Dairy", img:"img/front_it.48.200 (1).jpg"},
{name:"Nestl√© Fitness Original Cereal", price:3.29, category:"Cereal", img:"img/front_it.51.200.jpg"},
{name:"Lete Mineral Water 1.5L", price:0.49, category:"Drinks", img:"img/front_it.48.200.jpg"},
{name:"Doria Bucaneve Cookies", price:2.79, category:"Biscuits", img:"img/front_it.56.200.jpg"},
{name:"Mulino Bianco Galletti Cookies", price:2.29, category:"Biscuits", img:"img/front_it.86.200 (1) - Copia.jpg"},
{name:"Mikado Dark Chocolate Sticks", price:1.99, category:"Snacks", img:"img/front_it.88.200.jpg"},
{name:"Gocciole Chocolate Cookies 500g", price:2.79, category:"Biscuits", img:"img/front_it.117.200.jpg"},
{name:"Ichnusa Non Filtrata Beer", price:1.49, category:"Drinks", img:"img/front_it.122.200.jpg"},

{name:"Arla Summer Milk", price:1.49, category:"Dairy", img:"img/Arla-Standard-Milk_Iconic.jpg"},
{name:"Bananas (Bunch)", price:1.99, category:"Fruit", img:"img/Banana_Iconic.jpg"},
{name:"Granny Smith Apple", price:0.69, category:"Fruit", img:"img/Granny-Smith_Iconic.jpg"},
{name:"Green Bell Pepper", price:0.99, category:"Vegetables", img:"img/Green-Bell-Pepper_Iconic.jpg"},
{name:"Lemon", price:0.50, category:"Fruit", img:"img/Lemon_Iconic.jpg"},
{name:"Oatly Natural Oatgurt", price:2.19, category:"Dairy-free", img:"img/Oatly-Natural-Oatghurt_Iconic.jpg"},
{name:"Pink Lady Apple", price:0.79, category:"Fruit", img:"img/Pink-Lady_Iconic.jpg"},
{name:"Vine Tomatoes", price:1.99, category:"Vegetables", img:"img/Vine-Tomato_Iconic.jpg"},
{name:"Yellow Onion", price:0.40, category:"Vegetables", img:"img/Yellow-Onion_Iconic.jpg"},
{name:"Alpro Soya Milk Original", price:2.29, category:"Dairy-free", img:"img/Alpro-Fresh-Soy-Milk_Iconic.jpg"},

{name:"Vipiteno 0.1% Low-Fat Yogurt", price:1.69, category:"Dairy", img:"img/front_it.56.200 (2).jpg"},
{name:"Nestl√© Fitness Chocolate Bars (6-pack)", price:2.99, category:"Snacks", img:"img/front_fr.190.200.jpg"},
{name:"Conad Verso Natura Organic Chickpea Falafel", price:3.49, category:"Vegan", img:"img/front_it.3.200 (7).jpg"},
{name:"Parmareggio Butter", price:2.29, category:"Dairy", img:"img/front_it.9.200 (1).jpg"},
{name:"Mulino Bianco Fisarmoniche Biscuits", price:2.89, category:"Biscuits", img:"img/front_it.12.200.jpg"},
{name:"San Carlo Light Chips", price:1.89, category:"Snacks", img:"img/front_it.26.200.jpg"},
{name:"Estath√© Lemon 3-pack", price:1.69, category:"Drinks", img:"img/front_it.28.200 (2).jpg"},
{name:"Mulino Bianco Flauti Chocolate", price:2.99, category:"Bakery", img:"img/front_it.33.200 (1).jpg"},
{name:"Loacker Napolitaner Wafers", price:1.99, category:"Biscuits", img:"img/front_it.44.200.jpg"},
{name:"Pavesini 200g", price:1.99, category:"Biscuits", img:"img/Pavesini_Pavesi_200_g.jpg"},
{name:"M&M's Peanut", price:2.49, category:"Snacks", img:"img/front_it.296.200.jpg"},
{name:"Kinder Cioccolato", price:1.89, category:"Chocolate", img:"img/front_it.165.200.jpg"},


    // ---- Add filler products up to 70 ----
];



// --- MACRO-CATEGORIES FOR FILTERING ---
const macroCategories = {
    ALL: null, // no filter
    BREAKFAST: ["Cereal", "Biscuits", "Bakery", "Sweet spreads"],
    SNACKS: ["Snacks", "Chocolate", "Biscuits", "Sweet"],
    DRINKS: ["Drinks"],
    FRESH: ["Dairy", "Dairy-free", "Fresh Pasta", "Cold cuts", "Frozen"],
    HEALTHY: ["Vegan", "Fruit", "Vegetables", "Dry", "Canned"],
    PANTRY: ["Pasta", "Sauce", "Bread", "Spreads", "Misc"]
};

let currentMacroCategory = "ALL";
let productsFiltered = products; // inizialmente tutti


// Add placeholder items until we reach 70
while (products.length < 70) {
    products.push({
        name: "Placeholder Product " + (products.length + 1),
        price: (Math.random()*4+1).toFixed(2),
        category: "Misc",
        img: ""
    });
}





function showToast(msg) {
    const toast = document.getElementById("toast");
    toast.textContent = msg;
    toast.classList.add("show");

    setTimeout(() => {
        toast.classList.remove("show");
    }, 1500); // sparisce dopo 1.5 secondi
}



// --------------------------
// USER PROFILE VARIABLES
// --------------------------
let userID = "USER_" + Math.floor(Math.random() * 1000000);
let userAge = "";
let userGender = "";
let userNation = "";
let userOnline = "";
let userFreq = "";

let cartOpenTime = null;
let cartTimeLog = []; // opzionale, se vuoi loggare pi√π aperture
let deviceType = /Mobi|Android|iPhone|iPad/i.test(navigator.userAgent)
    ? "mobile"
    : "desktop";

let deviceInfo = navigator.userAgent; // opzionale


// --------------------------
// START EXPERIMENT FUNCTION
// --------------------------
function startExperiment() {

    userAge = document.getElementById("ageInput").value;
    userGender = document.getElementById("genderInput").value;
    userNation = document.getElementById("nationInput").value;
    userOnline = document.getElementById("onlineInput").value;
    userFreq = document.getElementById("freqInput").value;

    if (userAge === "" || userGender === "" || userNation === "") {
        alert("Please complete all required fields.");
        return;
		
    }

    // Hide the start screen
    document.getElementById("startScreen").style.display = "none";

    // Reset experiment timer
    experimentStart = Date.now();
	
	  // Forza partenza dall'alto, senza zoom
    window.scrollTo(0, 0);
    document.body.style.zoom = "1";

    console.log("Experiment started for:", userID);
}



function setCategory(cat) {
    currentMacroCategory = cat;

    // aggiorna stato visuale dei tab
    const tabs = document.querySelectorAll('.catTab');
    tabs.forEach(t => t.classList.remove('active'));
    tabs.forEach(t => {
        if (t.getAttribute('onclick') && t.getAttribute('onclick').includes("'" + cat + "'")) {
            t.classList.add('active');
        }
    });

    // filtro prodotti
    const cats = macroCategories[cat];
    if (!cats) {
        productsFiltered = products;
    } else {
        productsFiltered = products.filter(p => cats.includes(p.category));
    }

    buildShelf();
}

// -----------------------------------------------------------------------------
// BUILD SHELF
// -----------------------------------------------------------------------------
function buildShelf() {
    const shelf = document.getElementById("shelf");
    shelf.innerHTML = "";

    let grid = document.createElement("div");
    grid.className = "productGrid";
    shelf.appendChild(grid);

    let hoverStart = 0;

    // usa productsFiltered invece di products
    productsFiltered.forEach((p) => {

        let slot = document.createElement("div");
        slot.className = "product";

        // immagine
        let img = document.createElement("img");
        img.src = p.img || "https://via.placeholder.com/120";

        // nome
        let name = document.createElement("div");
        name.className = "name";
        name.textContent = p.name;

        // prezzo
        let price = document.createElement("div");
        price.className = "price";
        price.textContent = "‚Ç¨" + p.price;

        // HOVER SOLO DESKTOP
	slot.onmouseover = () => {
		if (deviceType !== "desktop") return;

		hoverStart = Date.now();
		hoverLog.push({
			product: p.name,
			hover_ms: Date.now() - experimentStart,
			device: deviceType
		});
	};

	slot.onmouseleave = () => {
		if (deviceType !== "desktop") return;

		let time = Date.now() - hoverStart;
		if (time > 1500) {
			indecisionLog.push({
				product: p.name,
				indecision_ms: time,
				device: deviceType
			});
		}
	};

			   // CLICK
		slot.onclick = () => {
			clickLog.push({
				product: p.name,
				price: p.price,
				category: p.category,
				click_ms: Date.now() - experimentStart,
				device: deviceType
			});


			// gestione carrello con quantit√†
			const existing = cart.find(item => item.name === p.name);
			if (existing) {
				existing.quantity += 1;
			} else {
				cart.push({
					name: p.name,
					price: p.price,
					quantity: 1
				});
			}

    updateCartTotal();
    document.getElementById("cartCount").innerText = getTotalItemsInCart();

    showToast(p.name + " added to cart ‚úì");
};


        slot.appendChild(img);
        slot.appendChild(name);
        slot.appendChild(price);

        grid.appendChild(slot);
    });
}


function updateCartTotal() {
    cartTotal = cart.reduce((sum, item) => sum + item.price * item.quantity, 0);
}

function getTotalItemsInCart() {
    return cart.reduce((sum, item) => sum + item.quantity, 0);
}



// buildShelf();
setCategory('ALL');


// -----------------------------------------------------------------------------
// CART
// -----------------------------------------------------------------------------
function openCart() {
    document.getElementById("shelf").style.display = "none";
    document.getElementById("cartPage").style.display = "block";

	cartOpenTime = Date.now();          // <-- aggiungi questa riga
    renderCartList();
}

function closeCart() {
    document.getElementById("cartPage").style.display = "none";
    document.getElementById("shelf").style.display = "block";
}

function renderCartList() {
    const list = document.getElementById("cartList");
    list.innerHTML = "";

    if (cart.length === 0) {
        list.innerHTML = "<li>Il carrello √® vuoto.</li>";
    } else {
        cart.forEach((item, index) => {
            const li = document.createElement("li");
						li.innerHTML = `
				${item.name} ‚Äì ‚Ç¨ ${item.price.toFixed(2)} x ${item.quantity}
				= ‚Ç¨ ${(item.price * item.quantity).toFixed(2)}
				<button class="removeBtn" onclick="removeFromCart(${index})">
					Remove
				</button>
			`;
            list.appendChild(li);
        });
    }

    document.getElementById("cartTotalDisplay").innerText =
        "Totale: ‚Ç¨ " + cartTotal.toFixed(2);
}

function removeFromCart(index) {
    if (cart[index].quantity > 1) {
        cart[index].quantity -= 1;
    } else {
        cart.splice(index, 1);
    }
    updateCartTotal();
    renderCartList();
    document.getElementById("cartCount").innerText = cart.length;
}



function finishShopping() {
    let totalTime = Date.now() - experimentStart;

    // tempo passato nel carrello dall'ultima apertura
    let cartDurationFinal = null;
    if (cartOpenTime !== null) {
        cartDurationFinal = Date.now() - cartOpenTime;
    }

    let data = {
        userID: userID,
        age: userAge,
        gender: userGender,
        nation: userNation,
        onlineFreq: userOnline,
        shopFreq: userFreq,
        totalTime: totalTime,
        clickLog: clickLog,
        hoverLog: hoverLog,
        indecisionLog: indecisionLog,
        cartDurationFinal: cartDurationFinal
    };

    document.getElementById("finishBtn").disabled = true;
    document.getElementById("finishBtn").innerText = "Submitting...";

    fetch("https://script.google.com/macros/s/AKfycbynE_0AMronN-Zdrt3PAknFdz--bZo5idPZRy71q1FC4KrUSx4YZ-1oQHWUXC3TQ5NaWg/exec", {
        method: "POST",
        mode: "no-cors",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
    }).then(() => {
        alert("Thank you! Your response has been recorded.");
        location.reload();
    }).catch(err => {
        alert("‚ö†Ô∏è Error submitting data. Please try again.");
        console.log(err);
    });
}







function showParticipantForm() {
    document.getElementById("introScreen").style.display = "none";
    document.getElementById("startScreen").style.display = "flex";
}



function resetToHome() {
    // pulisci carrello e log
    cart = [];
    clickLog = [];
    hoverLog = [];
    indecisionLog = [];
    document.getElementById("cartCount").innerText = "0";

    // mostra schermata iniziale, nasconde il resto
    document.getElementById("introScreen").style.display = "flex";
    document.getElementById("startScreen").style.display = "none";
    document.getElementById("shelf").style.display = "block";
    document.getElementById("cartPage").style.display = "none";
    document.getElementById("thankYouScreen").style.display = "none";

    experimentStart = Date.now();
}


</script>





<div id="thankYouScreen">
    <div class="thank-you-modal">
        <div class="thank-you-icon">üéâ</div>
        <h2>Thank you for participating!</h2>
        <p>Your responses have been recorded successfully.</p>
        <p style="font-size: 13px; color: #94a3b8;">You may now close this page.</p>
        <button class="thank-you-btn" onclick="resetToHome()">
            üè† Back to Home
        </button>
    </div>
</div>






</body>
</html>
